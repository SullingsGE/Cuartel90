<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>UNIDAD B1 - RECEPTOR</title>
    <style>
        body { margin: 0; background: #0b0e11; color: white; font-family: 'Segoe UI', sans-serif; display: flex; flex-direction: column; height: 100vh; }
        #header { background: #15191d; padding: 15px; text-align: center; border-bottom: 4px solid #e67e22; }
        #contenido { flex-grow: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 20px; }
        .alerta { background: #1a2229; border-left: 8px solid #e67e22; padding: 25px; border-radius: 10px; width: 90%; text-align: center; display: none; }
        #tipo { font-size: 32px; font-weight: bold; margin: 15px 0; }
        #btn-nav { 
            display: none; width: 100%; padding: 25px; background: #27ae60; color: white; 
            text-decoration: none; font-size: 22px; font-weight: bold; text-align: center;
        }
    </style>
</head>
<body>
    <div id="header">
        <div id="status">CONECTANDO...</div>
    </div>

    <div id="contenido">
        <div id="espera">ESPERANDO DESPACHO...</div>
        <div class="alerta" id="caja-alerta">
            <div style="color: #e67e22;">NUEVA EMERGENCIA</div>
            <div id="tipo"></div>
            <div id="hora" style="font-family: monospace; color: #888;"></div>
        </div>
    </div>

    <a id="btn-nav" href="#">INICIAR VIAJE (GPS)</a>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.2/mqttws31.min.js"></script>
    <script>
        var client = new Paho.MQTT.Client("broker.hivemq.com", 8884, "/mqtt", "REC_" + Math.random().toString(16).slice(2, 6));
        
        client.onMessageArrived = function(msg) {
            var data = JSON.parse(msg.payloadString);
            document.getElementById("espera").style.display = "none";
            document.getElementById("caja-alerta").style.display = "block";
            document.getElementById("tipo").innerText = data.aviso;
            document.getElementById("hora").innerText = "Recibido: " + new Date().toLocaleTimeString();
            
            // LINK DE NAVEGACIÃ“N
            var link = `https://www.google.com/maps/dir/?api=1&destination=${data.lat},${data.lon}&travelmode=driving`;
            var btn = document.getElementById("btn-nav");
            btn.href = link;
            btn.style.display = "block";

            // Alerta sonora
            var audio = new Audio('https://www.soundjay.com/buttons/beep-01a.mp3');
            audio.play();
        };

        client.connect({ useSSL: true, onSuccess: function() {
            document.getElementById("status").innerText = "UNIDAD B1 ONLINE";
            client.subscribe("bomberos/unidad/B1");
        }});
    </script>
</body>
</html>
